(function(u,l){typeof exports=="object"&&typeof module<"u"?module.exports=l():typeof define=="function"&&define.amd?define(l):(u=typeof globalThis<"u"?globalThis:u||self,u.main=l())})(this,function(){"use strict";var et=Object.defineProperty;var ot=(u,l,h)=>l in u?et(u,l,{enumerable:!0,configurable:!0,writable:!0,value:h}):u[l]=h;var M=(u,l,h)=>(ot(u,typeof l!="symbol"?l+"":l,h),h);const u=t=>Array.from({length:t}),l=(t,e)=>u(t).map(()=>u(e).map(()=>0)),h=t=>[t.length,t[0].length],I=(t,e)=>{const[o,s]=h(t),[c,n]=h(e);if(o!==c||s!==n)throw new Error(`M${o}x${s} can not add M${c}x${n}`);const r=l(o,s);for(let a=0;a<o;a++)for(let i=0;i<s;i++)r[a][i]=t[a][i]+e[a][i];return r},S=(t,e)=>{const[o,s]=h(t),[c,n]=h(e);if(o!==c||s!==n)throw new Error(`M${o}x${s} can not subtract M${c}x${n}`);const r=l(o,s);for(let a=0;a<o;a++)for(let i=0;i<s;i++)r[a][i]=t[a][i]-e[a][i];return r},v=(t,e)=>{const[o,s]=h(t),c=l(o,s);for(let n=0;n<o;n++)for(let r=0;r<s;r++)c[n][r]=t[n][r]*e;return c},F=(t,e)=>{const[o,s]=h(t),[c,n]=h(e);if(s!==c)throw new Error(`M${o}x${s} can not multiply M${c}x${n}`);const r=l(o,n);for(let a=0;a<o;a++)for(let i=0;i<n;i++)for(let m=0;m<s;m++)r[a][i]+=t[a][m]*e[m][i];return r},K=t=>{const[e,o]=h(t),s=l(o,e);for(let c=0;c<e;c++)for(let n=0;n<o;n++)s[n][c]=t[c][n];return s},k=(...t)=>{const e=t[t.length-1];return t.slice(0,t.length-1).reduceRight((o,s)=>F(s,o),e)},X={size:h,add:I,subtract:S,scale:v,multiply:F,transpose:K,compose:k},Y=(t,e,o,s)=>{const c=[[t],[e],[o]];return s!==void 0&&c.push([s]),c},R=t=>(t[3][0],[[t[0][0]/t[3][0]],[t[1][0]/t[3][0]],[t[2][0]/t[3][0]],[t[3][0]/t[3][0]]]),f={makeVector:Y,normalize:R},Z=(t,e)=>{const o=document.createElement("canvas");return o.width=t,o.height=e,o},_=(t,e,o)=>{e.forEach(s=>{t.beginPath();const c=s.map(n=>{const r=R(X.multiply(o,n));return{x:r[0][0],y:r[1][0],z:r[2][0]}});t.moveTo(c[0].x,c[0].y),c.concat(c[0]).slice(1).forEach(n=>{t.lineTo(n.x,n.y)}),t.stroke()})},B=(t,e,o)=>[[1,0,0,t],[0,1,0,e],[0,0,1,o],[0,0,0,1]],z=t=>[[t,0,0,0],[0,t,0,0],[0,0,t,0],[0,0,0,1]],D=t=>[[1,0,0,0],[0,Math.cos(t),-Math.sin(t),0],[0,Math.sin(t),Math.cos(t),0],[0,0,0,1]],G=t=>[[Math.cos(t),0,Math.sin(t),0],[0,1,0,0],[-Math.sin(t),0,Math.cos(t),0],[0,0,0,1]],H=t=>[[Math.cos(t),-Math.sin(t),0,0],[Math.sin(t),Math.cos(t),0,0],[0,0,1,0],[0,0,0,1]],J=[[1,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,1]],L=(t,e)=>[[t,0,0,0],[0,t,0,0],[0,0,t-e,t*e],[0,0,1,0]],N=(t,e,o)=>{const s=t/(e*Math.tan(o)*2),c=z(s);return c[1][1]*=-1,c},O=(t,e)=>[[1,0,0,t/2],[0,-1,0,e/2],[0,0,1,0],[0,0,0,1]],w=f.makeVector(0,0,Math.sqrt(3)*(2/3),1),g=f.makeVector(1,0,-Math.sqrt(3)/3,1),y=f.makeVector(-1,0,-Math.sqrt(3)/3,1),V=f.makeVector(0,Math.sqrt(8/3),0,1),Q=[[w,g,y],[w,g,V],[w,y,V],[g,y,V]],x=f.makeVector(1,-1,1,1),$=f.makeVector(-1,-1,1,1),T=f.makeVector(-1,-1,-1,1),b=f.makeVector(1,-1,-1,1),P=f.makeVector(1,1,1,1),j=f.makeVector(-1,1,1,1),q=f.makeVector(-1,1,-1,1),E=f.makeVector(1,1,-1,1),U={tetrahedron:Q,cube:[[x,$,T,b],[P,j,q,E],[x,$,j,P],[b,T,q,E],[x,b,E,P],[$,T,q,j]]};class W{constructor(){M(this,"lastTimestamp");M(this,"callbacks",[]);M(this,"stopFlag",!1);M(this,"update",e=>{const o=this.lastTimestamp?e-this.lastTimestamp:0;this.callbacks.forEach(s=>s(o)),this.lastTimestamp=e,this.stopFlag||window.requestAnimationFrame(this.update)})}start(){this.stopFlag=!1,window.requestAnimationFrame(this.update)}stop(){this.stopFlag=!0}}const tt=document.querySelector("#app");return()=>{const c=Math.PI/3;let n=0,r=0,a=0;const i=Z(800,450);tt.append(i);const m=k(O(800,450),N(450,-10,c),J,L(-10,-50)),A=i.getContext("2d"),C=new W;window.onkeydown=p=>{const d=p.shiftKey?-1:1;p.keyCode===88?n+=Math.PI/180*d:p.keyCode===89?r+=Math.PI/180*d:p.keyCode===90&&(a+=Math.PI/180*d)},C.callbacks.push(p=>{const d=k(B(0,0,-20),H(a),G(r),D(n),z(8));A.clearRect(0,0,800,450),_(A,U.cube,k(m,d))}),C.start()}});
