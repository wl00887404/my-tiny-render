(function(f,l){typeof exports=="object"&&typeof module<"u"?module.exports=l():typeof define=="function"&&define.amd?define(l):(f=typeof globalThis<"u"?globalThis:f||self,f.main=l())})(this,function(){"use strict";var ut=Object.defineProperty;var ft=(f,l,h)=>l in f?ut(f,l,{enumerable:!0,configurable:!0,writable:!0,value:h}):f[l]=h;var w=(f,l,h)=>(ft(f,typeof l!="symbol"?l+"":l,h),h);const f=t=>Array.from({length:t}),l=(t,e)=>f(t).map(()=>f(e).map(()=>0)),h=t=>[t.length,t[0].length],L=(t,e)=>{const[o,s]=h(t),[c,n]=h(e);if(o!==c||s!==n)throw new Error(`M${o}x${s} can not add M${c}x${n}`);const r=l(o,s);for(let i=0;i<o;i++)for(let a=0;a<s;a++)r[i][a]=t[i][a]+e[i][a];return r},X=(t,e)=>{const[o,s]=h(t),[c,n]=h(e);if(o!==c||s!==n)throw new Error(`M${o}x${s} can not subtract M${c}x${n}`);const r=l(o,s);for(let i=0;i<o;i++)for(let a=0;a<s;a++)r[i][a]=t[i][a]-e[i][a];return r},Y=(t,e)=>{const[o,s]=h(t),c=l(o,s);for(let n=0;n<o;n++)for(let r=0;r<s;r++)c[n][r]=t[n][r]*e;return c},R=(t,e)=>{const[o,s]=h(t),[c,n]=h(e);if(s!==c)throw new Error(`M${o}x${s} can not multiply M${c}x${n}`);const r=l(o,n);for(let i=0;i<o;i++)for(let a=0;a<n;a++)for(let m=0;m<s;m++)r[i][a]+=t[i][m]*e[m][a];return r},Z=t=>{const[e,o]=h(t),s=l(o,e);for(let c=0;c<e;c++)for(let n=0;n<o;n++)s[n][c]=t[c][n];return s},y=(...t)=>{const e=t[t.length-1];return t.slice(0,t.length-1).reduceRight((o,s)=>R(s,o),e)},M={size:h,add:L,subtract:X,scale:Y,multiply:R,transpose:Z,compose:y},S=(t,e,o,s)=>{const c=[[t],[e],[o]];return s!==void 0&&c.push([s]),c},B=M.add,D=M.subtract,G=t=>[t[0][0],t[1][0],t[2][0],t[3][0]],H=M.scale,J=(t,e)=>M.multiply(t,M.transpose(e))[0][0],K=t=>Math.sqrt(J(t,t)),v=t=>{if(N(t))return H(t,1/K(t));const[e,o,s,c]=G(t);return S(e/c,o/c,s/c,1)},N=t=>t[3][0]===0,p={makeVector:S,normalize:v,add:B,subtract:D},O=(t,e)=>{const o=document.createElement("canvas");return o.width=t,o.height=e,o},Q=(t,e,o)=>{e.forEach(s=>{t.beginPath();const c=s.map(n=>{const r=v(M.multiply(o,n));return{x:r[0][0],y:r[1][0],z:r[2][0]}});t.moveTo(c[0].x,c[0].y),c.concat(c[0]).slice(1).forEach(n=>{t.lineTo(n.x,n.y)}),t.stroke()})},U=(t,e,o)=>[[1,0,0,t],[0,1,0,e],[0,0,1,o],[0,0,0,1]],A=t=>[[t,0,0,0],[0,t,0,0],[0,0,t,0],[0,0,0,1]],W=t=>[[1,0,0,0],[0,Math.cos(t),-Math.sin(t),0],[0,Math.sin(t),Math.cos(t),0],[0,0,0,1]],_=t=>[[Math.cos(t),0,Math.sin(t),0],[0,1,0,0],[-Math.sin(t),0,Math.cos(t),0],[0,0,0,1]],tt=t=>[[Math.cos(t),-Math.sin(t),0,0],[Math.sin(t),Math.cos(t),0,0],[0,0,1,0],[0,0,0,1]],et=[[1,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,1]],ot=(t,e)=>[[t,0,0,0],[0,t,0,0],[0,0,t-e,t*e],[0,0,1,0]],st=(t,e,o)=>{const s=t/(e*Math.tan(o)*2),c=A(s);return c[1][1]*=-1,c},ct=(t,e)=>[[1,0,0,t/2],[0,-1,0,e/2],[0,0,1,0],[0,0,0,1]],g=p.makeVector(0,0,Math.sqrt(3)*(2/3),1),x=p.makeVector(1,0,-Math.sqrt(3)/3,1),$=p.makeVector(-1,0,-Math.sqrt(3)/3,1),V=p.makeVector(0,Math.sqrt(8/3),0,1),nt=[[g,x,$],[g,x,V],[g,$,V],[x,$,V]],b=p.makeVector(1,-1,1,1),z=p.makeVector(-1,-1,1,1),P=p.makeVector(-1,-1,-1,1),T=p.makeVector(1,-1,-1,1),j=p.makeVector(1,1,1,1),q=p.makeVector(-1,1,1,1),E=p.makeVector(-1,1,-1,1),F=p.makeVector(1,1,-1,1),rt={tetrahedron:nt,cube:[[b,z,P,T],[j,q,E,F],[b,z,q,j],[T,P,E,F],[b,T,F,j],[z,P,E,q]]};class at{constructor(){w(this,"lastTimestamp");w(this,"callbacks",[]);w(this,"stopFlag",!1);w(this,"update",e=>{const o=this.lastTimestamp?e-this.lastTimestamp:0;this.callbacks.forEach(s=>s(o)),this.lastTimestamp=e,this.stopFlag||window.requestAnimationFrame(this.update)})}start(){this.stopFlag=!1,window.requestAnimationFrame(this.update)}stop(){this.stopFlag=!0}}const it=document.querySelector("#app");return()=>{const c=Math.PI/3;let n=0,r=0,i=0;const a=.5,m=O(800,450),k={x:!1,y:!1,z:!1,shift:!1};it.append(m);const lt=y(ct(800,450),st(450,-10,c),et,ot(-10,-50)),I=m.getContext("2d"),C=new at;window.onkeydown=d=>{const u=d.key.toLowerCase();u!=="x"&&u!=="y"&&u!=="z"&&u!="shift"||(k[u]=!0)},window.onkeyup=d=>{const u=d.key.toLowerCase();u!=="x"&&u!=="y"&&u!=="z"&&u!="shift"||(k[u]=!1)},C.callbacks.push(d=>{const u=k.shift?-1:1;k.x?n+=a*(Math.PI/180)*u*d:k.y?r+=a*(Math.PI/180)*u*d:k.z&&(i+=a*(Math.PI/180)*u*d);const ht=y(U(0,0,-20),tt(i),_(r),W(n),A(8));I.clearRect(0,0,800,450),Q(I,rt.cube,y(lt,ht))}),C.start()}});
